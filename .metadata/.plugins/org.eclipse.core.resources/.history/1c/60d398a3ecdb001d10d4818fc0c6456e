DROP TABLE IF EXISTS MEMBER;
DROP TABLE IF EXISTS MEMBERTRASH;
DROP TABLE IF EXISTS BOOK;
DROP TABLE IF EXISTS BOOKLOAN;

CREATE TABLE MEMBER (
    ID NUMBER(8) GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    NAME VARCHAR2(100) NOT NULL,
    SIGNUPDAY DATE DEFAULT SYSDATE NOT NULL,
    ADDRESS VARCHAR2(100),
    PHONENUMBER VARCHAR2(11) UNIQUE NOT NULL,
    BIRTHDAY DATE NOT NULL
);

CREATE TABLE MEMBERTRASH (
    ID NUMBER(8) PRIMARY KEY,
    NAME VARCHAR2(100) NOT NULL,
    SIGNUPDAY DATE DEFAULT SYSDATE NOT NULL,
    ADDRESS VARCHAR2(100),
    PHONENUMBER VARCHAR2(11) UNIQUE NOT NULL,
    BIRTHDAY DATE NOT NULL
);

CREATE TABLE BOOK (
    ID NUMBER(8) GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    TITLE VARCHAR2(100) NOT NULL,
    PUBLISHDATE DATE NOT NULL
);

CREATE TABLE BOOKLOAN (
    ID NUMBER(8) GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    BOOKID NUMBER(8) NOT NULL,
    MEMBERID NUMBER(8) NOT NULL,
    ISEXTENSION NUMBER(1) DEFAULT 0 NOT NULL,
    LOANDATE DATE DEFAULT SYSDATE NOT NULL,
    DEADLINE DATE DEFAULT SYSDATE NOT NULL,
    CONSTRAINT FK_MEMBER FOREIGN KEY (MEMBERID) REFERENCES MEMBER(ID) ON DELETE CASCADE,
    CONSTRAINT FK_BOOK FOREIGN KEY (BOOKID) REFERENCES BOOK(ID) ON DELETE CASCADE,
    CONSTRAINT BOOKLOAN_UK UNIQUE (BOOKID, MEMBERID)
);

INSERT INTO MEMBER (name, address, phonenumber, birthday) VALUES ('박경덕', '서울시 광명', '01011112222', '19990101');
INSERT INTO MEMBER (name, address, phonenumber, birthday) VALUES ('박준하', '서울시 중구', '01025728320', '19961123');
INSERT INTO MEMBER (name, address, phonenumber, birthday) VALUES ('박태현', '경기도 안양', '01059382012', '19960505');

INSERT INTO BOOK(title, publishdate) VALUES ('백두산', '2002-02-02');
INSERT INTO BOOK(title, publishdate) VALUES ('어린왕자', '2012-05-18');
INSERT INTO BOOK(title, publishdate) VALUES ('그리고 아무도 없었다', '2005-11-21');

INSERT INTO BOOKLOAN(bookid, memberid) VALUES (1, 1);
INSERT INTO BOOKLOAN(bookid, memberid) VALUES (2, 2);
