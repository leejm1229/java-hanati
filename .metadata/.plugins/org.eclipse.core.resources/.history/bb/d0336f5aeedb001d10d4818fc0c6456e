DROP TABLE BOOKLOAN;
DROP TABLE MEMBER;
DROP TABLE MEMBERTRASH;
DROP TABLE BOOK;

CREATE TABLE SCOTT.MEMBER (
ID NUMBER(8) NOT NULL,
NAME VARCHAR2(100) NOT NULL,
SIGNUPDAY VARCHAR2(10) DEFAULT TO_CHAR(SYSDATE, 'YYYY-MM-DD') NOT NULL,
ADDRESS VARCHAR2(100) NULL,
PHONENUMBER VARCHAR2(11) NOT NULL,
BIRTHDAY VARCHAR2(8) NOT NULL,
CONSTRAINT MEMBER_PK PRIMARY KEY (ID),
CONSTRAINT MEMBER_UN UNIQUE (PHONENUMBER)
);

CREATE TABLE SCOTT.MEMBERTRASH (
ID NUMBER(8) NOT NULL,
NAME VARCHAR2(100) NOT NULL,
SIGNUPDAY VARCHAR2(10) DEFAULT TO_CHAR(SYSDATE, 'YYYY-MM-DD') NOT NULL,
ADDRESS VARCHAR2(100) NULL,
PHONENUMBER VARCHAR2(11) NOT NULL,
BIRTHDAY VARCHAR2(8) NOT NULL
);

CREATE TABLE SCOTT.BOOK (
ID NUMBER(8) NOT NULL,
TITLE VARCHAR2(100) NOT NULL,
PUBLISHDATE VARCHAR2(20),
ISRETURNED NUMBER(1) DEFAULT 1 NOT NULL CONSTRAINT CHK_IS_RETURNED CHECK (ISRETURNED BETWEEN 0 AND 1),
CONSTRAINT BOOK_PK PRIMARY KEY (ID),
CONSTRAINT BOOK_UN UNIQUE (TITLE)
);

CREATE TABLE SCOTT.BOOKLOAN (
ID NUMBER(8) NOT NULL,
BOOKID NUMBER(8) NOT NULL,
MEMBERID NUMBER(8) NOT NULL,
ISEXTENSION NUMBER(1) DEFAULT 0 NOT NULL CONSTRAINT CHK_IS_EXTENSION CHECK (ISEXTENSION BETWEEN 0 AND 1),
LOANDATE VARCHAR2(10) DEFAULT TO_CHAR(SYSDATE, 'YYYY-MM-DD') NOT NULL,
DEADLINE VARCHAR2(10) DEFAULT TO_CHAR(SYSDATE, 'YYYY-MM-DD') NOT NULL ,
CONSTRAINT FK_MEMBER FOREIGN KEY (MEMBERID) REFERENCES SCOTT.MEMBER(ID) ON DELETE CASCADE,
CONSTRAINT FK_BOOK FOREIGN KEY (BOOKID) REFERENCES SCOTT.BOOK(ID) ON DELETE CASCADE,
CONSTRAINT BOOKLOAN_UK UNIQUE (BOOKID, MEMBERID)
);

DROP SEQUENCE SCOTT.MEMBER_SEQ;
DROP SEQUENCE SCOTT.BOOK_SEQ;
DROP SEQUENCE SCOTT.BOOKLOAN_SEQ;

CREATE SEQUENCE SCOTT.MEMBER_SEQ
INCREMENT BY 1
START WITH 1
MAXVALUE 99999999
MINVALUE 1
NOCYCLE;

CREATE SEQUENCE SCOTT.BOOK_SEQ
INCREMENT BY 1
START WITH 1
MAXVALUE 99999999
MINVALUE 1
NOCYCLE;

CREATE SEQUENCE SCOTT.BOOKLOAN_SEQ
INCREMENT BY 1
START WITH 1
MAXVALUE 99999999
MINVALUE 1
NOCYCLE;

-- 테이블 수정 (ID 컬럼에 DEFAULT 제약 조건 추가)
ALTER TABLE SCOTT.MEMBER
MODIFY ID NUMBER(8) DEFAULT SCOTT.MEMBER_SEQ.NEXTVAL;

ALTER TABLE SCOTT.BOOK
MODIFY ID NUMBER(8) DEFAULT SCOTT.BOOK_SEQ.NEXTVAL;

ALTER TABLE SCOTT.BOOKLOAN
MODIFY ID NUMBER(8) DEFAULT SCOTT.BOOKLOAN_SEQ.NEXTVAL;

INSERT INTO MEMBER (NAME, ADDRESS, PHONENUMBER, BIRTHDAY) VALUES ('박경덕','서울시 광명', '01011112222','19981212');
INSERT INTO MEMBER (NAME, ADDRESS, PHONENUMBER, BIRTHDAY) VALUES ('박준하','서울시 중구', '01025728320','19961123');
INSERT INTO MEMBER (NAME, ADDRESS, PHONENUMBER, BIRTHDAY) VALUES ('박태현','경기도 안양', '01059382012','19960505');

INSERT INTO BOOK(TITLE,PUBLISHDATE) values('백두산','2002-02-02');
INSERT INTO BOOK(TITLE,PUBLISHDATE) values('어린왕자','2012-05-18');
INSERT INTO BOOK(TITLE,PUBLISHDATE) values('그리고 아무도 없었다','2005-11-21');

INSERT INTO BOOKLOAN(BOOKID,MEMBERID) values(1,1);
INSERT INTO BOOKLOAN(BOOKID,MEMBERID) values(2,2);

